-- Ustvarjanje PB
CREATE DATABASE GlasbenaZbirka_innoDB
CHARACTER SET utf8
COLLATE utf8_slovenian_ci;

-- 2.
CREATE TABLE Avtor(
  id      INT                                                                 NOT NULL AUTO_INCREMENT,
  ime     VARCHAR(20)                                                         NOT NULL,
  priimek VARCHAR(20)                                                         NOT NULL,
  opus    SET('opera', 'kantata', 'simfonija', 'koncert', 'balada', 'drugo')  NOT NULL,

  PRIMARY KEY(id)
)
ENGINE = innoDB;

CREATE TABLE Posnetek(
  pid       INT                             NOT NULL AUTO_INCREMENT,
  naslov    VARCHAR(30)                     NOT NULL,
  genre     ENUM('klasika', 'pop', 'jazz')  NOT NULL,
  trajanje  TIME                            NOT NULL,
  avtorId   INT                             NOT NULL,
  
  PRIMARY KEY(pid),
  FOREIGN KEY (avtorId) REFERENCES Avtor(id)
)
ENGINE = innoDB;

CREATE TABLE Lastnik(
  lid     INT             NOT NULL AUTO_INCREMENT,
  ime     VARCHAR(20)     NOT NULL,
  priimek VARCHAR(20)     NOT NULL,
  tel     VARCHAR(20)     NOT NULL,
  eMail   VARCHAR(30)     NOT NULL,

  PRIMARY KEY(lid)
)
ENGINE = innoDB;

CREATE TABLE CD(
  id        INT           NOT NULL AUTO_INCREMENT,
  naslovCD  VARCHAR(30)   NOT NULL,
  cena      DECIMAL(2)    NOT NULL,
  opombe    VARCHAR(150)  NOT NULL,
  lastnik   INT           NOT NULL,

  PRIMARY KEY (id)
)
ENGINE = innoDB;

CREATE TABLE Vsebina(
  cdId  INT  NOT NULL,
  pid   INT  NOT NULL,

  PRIMARY KEY (cdId, pid),
  FOREIGN KEY (cdId)  REFERENCES CD(id),
  FOREIGN KEY (pid)   REFERENCES Posnetek(pid)
)
ENGINE = innoDB;

-- Postavljanje integritetnih omejitev tujih kljuƒçev ni uspelo, saj smo CD definirali pred Lastnik

-- 3.
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                                                                                                                                                                                                                                                                                     |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Avtor | CREATE TABLE `Avtor` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ime` varchar(20) COLLATE utf8mb3_slovenian_ci NOT NULL,
  `priimek` varchar(20) COLLATE utf8mb3_slovenian_ci NOT NULL,
  `opus` set('opera','kantata','simfonija','koncert','balada','drugo') COLLATE utf8mb3_slovenian_ci NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_slovenian_ci |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Posnetek | CREATE TABLE `Posnetek` (
  `pid` int(11) NOT NULL AUTO_INCREMENT,
  `naslov` varchar(30) COLLATE utf8mb3_slovenian_ci NOT NULL,
  `genre` enum('klasika','pop','jazz') COLLATE utf8mb3_slovenian_ci NOT NULL,
  `trajanje` time NOT NULL,
  `avtorId` int(11) NOT NULL,
  PRIMARY KEY (`pid`),
  KEY `avtorId` (`avtorId`),
  CONSTRAINT `Posnetek_ibfk_1` FOREIGN KEY (`avtorId`) REFERENCES `Avtor` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_slovenian_ci |
+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table                                                                                                                                                                                                                                                                                                                                                                                                   |
+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Lastnik | CREATE TABLE `Lastnik` (
  `lid` int(11) NOT NULL AUTO_INCREMENT,
  `ime` varchar(20) COLLATE utf8mb3_slovenian_ci NOT NULL,
  `priimek` varchar(20) COLLATE utf8mb3_slovenian_ci NOT NULL,
  `tel` varchar(20) COLLATE utf8mb3_slovenian_ci NOT NULL,
  `eMail` varchar(30) COLLATE utf8mb3_slovenian_ci NOT NULL,
  PRIMARY KEY (`lid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_slovenian_ci |
+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| CD    | CREATE TABLE `CD` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `naslovCD` varchar(30) COLLATE utf8mb3_slovenian_ci NOT NULL,
  `cena` decimal(2,0) NOT NULL,
  `opombe` varchar(150) COLLATE utf8mb3_slovenian_ci NOT NULL,
  `lastnik` int(11) NOT NULL,
  PRIMARY KEY (`id`),
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_slovenian_ci |
+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table                                                                                                                                                                                                                                                                                                                                                     |
+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Vsebina | CREATE TABLE `Vsebina` (
  `cdId` int(11) NOT NULL,
  `pid` int(11) NOT NULL,
  PRIMARY KEY (`cdId`,`pid`),
  KEY `pid` (`pid`),
  CONSTRAINT `Vsebina_ibfk_1` FOREIGN KEY (`cdId`) REFERENCES `CD` (`id`),
  CONSTRAINT `Vsebina_ibfk_2` FOREIGN KEY (`pid`) REFERENCES `Posnetek` (`pid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_slovenian_ci |
+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

-- 4.
ALTER TABLE CD ADD FOREIGN KEY (lastnik) REFERENCES Lastnik(lid);

-- 5.


-- 7.
CREATE TABLE Owner AS 
  SELECT * FROM Lastnik;

-- 8.
